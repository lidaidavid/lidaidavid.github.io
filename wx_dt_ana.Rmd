---
title: "网校数据分析提案"
author: "学科产品部"
date: "`r format(Sys.time(), '%Y.%m.%d')`"
output: 
  html_document:
    css: 
    theme: united
    highlight: kate
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
---

<script>
    window.oncontextmenu = function () {
        console.log("Right Click Disabled");
        return false;
    }
</script>
```{r setup, include=FALSE}
# default, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, and yeti
#  default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark, and textmate
knitr::opts_chunk$set(echo = TRUE)
#setwd("C:/Users/david/Documents/GitHub/lidaidavid.github.io/20191021 classes/")
library(tidyverse)
library(readxl)
library(plotly)
# library(extrafont)
Sys.setlocale("LC_CTYPE", "Chinese")
#font <- "STXihei"
#load("C:/0work/0tal/1 online_db/outputdata.RData")

#dir1 <- "C:/Users/david/Documents/GitHub/lidaidavid.github.io/20191021classes/"

#dir1 <- "https://lidaidavid.github.io/20191021classes/"

```

# 研究问题

## 哪些因素会影响学生的 转化/续报/退费 行为？

+ 我们的认知是，学生的 转化/续报/退费 行为会受若干内部与外部因素影响。

+ 学生的行为是结果，影响因素是原因；学生的行为因影响因素的变化而改变。因此，可以定义学生的 转化/续报/退费 为取值为1或0的因变量，影响因素为各种类型的自变量，建立因变量与自变量之间的关系。

## 研究=假设检验

+ 研究问题转化成典型的社会科学研究问题：当哪些因素发生变化时，学生的转化/续报/退费行为会因而发生变化？要解答这些问题，可以采用社会科学中的假设检验来进行分析。

# 研究方法

## 实验法

+ 前述问题探究的是因素之间的因果关系，在理想条件下可以采用实验法进行考察。在科学地控制变量、选取相互匹配的实验组和控制组之后进行A/B测试，是实验法的一种方式。实验法的问题是成本较高，成本包括时间成本、资源投入和给用户带来的体验损失。因此，并不是所有问题都适合用实验法解答。

+ 实验法最突出的问题是，进行一个科学、完整的实验周期比较长。对于反馈周期较长的教育产品来说这一问题尤为突出。例如，秋季课程完整的要15周，这就意味着实验周期长达15周。当然可以通过对短期课程进行实验来缩短实验周期，但这就意味着结果不一定可以推广到系统班。

## 数据挖掘

+ 利用观察数据（或行为痕迹数据），也可以探讨学生行为与影响因素之间的关系。在数据较为理想的情况下，可以采用因果推断（causal inference）的方法建模分析（另一种策略是寻找工具变量，但是工具变量非常难以构建）；更为基本的是采用广义线性模型（GLM）中的逻辑斯蒂回归（logistic regression or logit model），对二分因变量的关联因素进行分析。

+ 考虑到学生有生命周期、变量有多个层次、同班级之间可能会相互影响，还要考虑到生存分析（survival analysis）、层级模型（hierarchical model）和社会网络分析（social network analysis）等更加复杂的方法。

+ 本提案，考虑到数据现在可能处于比较初级阶段、希望在尽量短的时间内获得信息、对科学方法的适用性认知仍属初步，建议采用最基本的**逻辑斯蒂回归**来控制变量、进行数据分析。


## 为什么要用科学方法

+ 业务伙伴的共识是，多个因素共同作用，影响学生行为。因此，不控制变量、不统计检验，仅进行简单的单变量、双变量描述统计，很可能得出错误的结论。

+ 学生行为是个体层面的行为，在有数据的情况下应该直接使用个体层面的数据进行分析，例如是否转化、是否续报等等。对一个班级计算的转化率、续报x率等数据，已经是聚合之后的结果，损失了重要信息，在有条件的情况下不应该用其进行分析。

```{r, include=TRUE, echo = FALSE}
set.seed(2)

(1280000  + 235000 + 250000) / 300

300 * 6000

out <- numeric()
i <- 1
while(i <= 5883){
  dt <- sample(c(0, 1), 300, replace = T, prob = c(0.85, 0.15))
  out <- out %>% append(dt %>% mean())
  i <- i + 1
}

gg <- cbind(seq(1, 5883), out) %>% as.data.frame()
colnames(gg) <- c("id", "rate")
gg <- gg %>% arrange(rate)
```


+ 如果不用科学方法进行分析，理解问题有可能陷入误区。例如，暑期班的续报率可能在班级之间有较大差异，有的达到30%以上，有的在5%以下，让人惊叹。但是实际上由于正态分布的性质，当研究的班级足够多的时候，总会出现足够多的超高续报率或者超低续报率的班级。假设每个学生都通过掷色子决定自己是否续报，续报的概率是15%，一个班级有50个人，那么这个班级续报率的分布就是一个二项分布，可以近似看作一个正态分布。假设有1000个一模一样的小班，那么进行一次随机抽取，结束后其续报率超过30%的有`r sum(gg$rate >= 0.3)`个，低于5%的有`r sum(gg$rate <= 0.05)`个。要注意，这一差别完全是随机投掷色子导致的结果，跟其他任何因素都没有关系。如果我们这时候把首尾两端的班级找出来逆推因果，得出的结论肯定是不可靠的。


### 续报率最高的10个班级

```{r, include=TRUE, echo = FALSE}
head(gg, 10)
```

### 续报率最低的10个班级

```{r, include=TRUE, echo = FALSE}
tail(gg, 10)
```

### 续报率的概率密度分布
```{r, include=TRUE, echo = FALSE}
ggplot(data = gg, aes(x = rate)) + 
  geom_density() +
  geom_vline(xintercept = c(0.3,0.05))

```


# 理论基础

+ 业务伙伴在一线获得的经验是建立理论体系、进行假设检验的基础。一切业务伙伴关于影响学生行为的因素的故事，都可以重新整合成学生行为作为因变量和其他因素之间此消彼长的关系，当有完善的数据的情况下可以用前述方法进行分析。

## 案例：重辅导对学生转化是否有显著影响？

+ 例如：业务伙伴猜测辅导老师的服务加重会对学生转化行为产生影响

    - 因变量：学生的转化行为。转化 = 新学员 且 上过优选课 且 续报下一季系统课程
 
    - 自变量：在优选课期间的辅导老师与其进行私聊的次数/文字长度/个性程度 + 是否进行过视频/音频一对一 + 在群运营中\@该学生的次数/文字长度/个性程度 + 给该学生发送物料总次数/个性程度
 
    - 控制变量：学生的城市（级别、人均gdp、区域） + 学生性别 + 学生年级 + 家庭经济状况 + 学生学习水平 + 报课学科 + 课程难度 + 教材版本 
    
## 案例：辅导和主讲谁对转化的效应更大？

+ 业务伙伴还会关心的问题：主讲和辅导谁对转化行为的影响更大？在保持前述模型不变的情况下，加入主讲相关的研究变量，就可以在控制了辅导老师的效应之余，策略主讲的影响。二者比较，就可以看出主讲和辅导谁的效果更大。

    - 增加变量：主讲素质（入职时长/课时费） + 是否在课程中与主讲互动过（被点名表扬etc）+ 主讲课上互动次数（时间） + 主讲与学生私下交流的次数

+ 根据业务伙伴对转化机制的理解，还可以把更多有待检验的假设转换成模型进行分析，从而验证认知。有些理解不一定有现成的数据可以使用，可以在现有条件下进行基础分析，循序渐进，如果方法确有成效再去收集其他认为可能有价值的数据。

# 可行性

## 上述研究面临的挑战

+ 科学方法有自身的条件，而业务数据不一定能够满足这些条件。下面对上述研究方法面临的挑战进行评估，从而判断研究是否可行。

    - 样本量：网校积累了140万用户的数据，样本量相当大。从正面来说，样本量越大，数据分析的结果就越可靠、能够建构的模型就越复杂（变量越多）。从反面来说，大样本量意味着数据调用和清理的难度会更大，而且由于内存限制个人电脑可能无法处理。
        
        1. 对140万数据进行抽样，即使1万4千人的量可能也足以完成前述分析，而这一规模个人电脑能够处理。
        
        2. 调配专门的技术专家，采用sql进行数据管理、python进行数据分析、调用服务器提供计算资源支持，对140万数据进行全量分析。可以先跑小样本把代码跑通，再委托技术专家将其迁移到全数据上。
    
    - 字段数（变量数）：网校数据中供给端和学生端都有不少变量，但是很多重要变量可能是缺失的。例如，在供给端对辅导老师的服务程度没有科学评估、对主讲教学水平也没有科学评估。前部分给出了一些初步的建议，通过其他数据源变量（聊天记录、绩效考核）来间接构建这些变量，其有效性需要在实践中检验。在学生端，学生的个人信息有很多可能并未收集或者尚未形成结构化数据，要控制起来比较困难。
        
        1. 要在发展的眼光中看待这一问题。学生的个人信息、行为数据有很大的价值，任何互联网企业都会非常愿意采集、利用，网校同样有动机加以采集。如果本研究能产出有说服力的成果，可以预见数据变量日后会日益完善。
        2. 辅导老师与学生深度触及，很多我们缺失的变量并不是不为人知，而是辅导老师没有敏感度去采集/没有工具进行总结。如果能够提供良好的数据录入工具，支持辅导老师对全部学生深度了解、整合数据，有利于解决前述问题。
        
    - 研究能力：逻辑斯蒂回归本身是非常基本的方法，R、python等数据分析语言也有现成的工具包进行分析。在研究能力上欠缺的方面主要是
        1. 进行分析前，能够深刻理解数据结构和分析目标，从而对数据进行整合和清理
        2. 进行分析后，能够对分析结果进行正确理解，并翻译成非专家能够理解的语言。更重要的是对分析结果的局限有清醒认识，并能提出改进建议。
    生存分析、层级模型、社会网络分析等复杂的方法对统计知识有更高的要求，可能需要外部能力的协助。好在我集团有良好的智力支持资源，可以向北京大学、清华大学的研究者求助，能力应该不会成为限制。

## 评估结果

+ 网校现有存量数据，可以支持对研究问题进行初步分析，采用逻辑斯蒂回归模型取得初步的结果。该研究提出的挑战并非完全不可克服，与其可能产生的价值相比处于次要地位。

+ 在对存量数据进行盘点、与技术专家进行咨询之前，难以判断研究投入的时间与资源规模。在目前的时间点判断，如果研究团队专人全职进行分析，数据资源权限给到位，要花的时间在1个月到6个月之间。好处是分析跑通之后可以常态化，每隔一段时间重新筛选数据就可以重复分析，检验结果是否仍然成立，而其成本很低。

+ 总之，本提案认为对网校存量数据进行初步的统计分析对理解用户需求、澄清转化机制、指导网校决策有重大价值，可以考虑组建专家团队开展研究。
    